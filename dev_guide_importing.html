<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.8.17"/>
    <style>
        /*!
         * IE10 viewport hack for Surface/desktop Windows 8 bug
         * Copyright 2014-2015 Twitter, Inc.
         * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
         */
        @-webkit-viewport { width: device-width; }
        @-moz-viewport    { width: device-width; }
        @-ms-viewport     { width: device-width; }
        @-o-viewport      { width: device-width; }
        @viewport         { width: device-width; }
      </style>
  <title>SpECTRE: Importing data</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="bootstrap.min.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="popper.min.js"></script>
  <script type="text/javascript" src="bootstrap.min.js"></script>
  <script type="text/javascript" src="spectre.js"></script>
  </head>
  <body>
  <div id="top" class="navbar-fixed-top"><!-- do not remove this div, it is closed by doxygen! -->
  <!-- BEGIN TITLEAREA -->
  <div id="titlearea">
  <script type="text/javascript">
  var searchBox = new SearchBox("searchBox", "search",false,'Search');
  </script>
  <div id="main-nav">
    <ul class="sm sm-dox" id="main-menu">
      <li>
      <a href="index.html">
      SpECTRE &#160;
        <span id="projectnumber">v0.0.0</span>
      </a>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-book"></i><span>Documentation</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 135px;">
            <a href="index.html">
            <i class="octicon octicon-book"></i><span>Introduction</span></a>
          </li>
          <li style="min-width: 135px;">
            <a href="installation.html">
              <i class="octicon octicon-desktop-download"></i><span>Installation</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="tutorials.html">
              <i class="octicon octicon-mortar-board"></i><span>User Tutorials</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="dev_guide.html">
              <i class="octicon octicon-gist-secret"></i><span>Dev Guide</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="code_of_conduct.html">
              <i class="octicon octicon-comment-discussion"></i><span>Code of Conduct</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="contributing_to_spectre.html">
              <i class="octicon octicon-git-pull-request"></i><span>Contributing Guide</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-code"></i>
              <span>Code Reference</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 130px;">
            <a href="modules.html">
              <i class="octicon octicon-code"></i>
              <span>Topics</span>
            </a>
          </li>
          <li style="min-width: 130px;">
            <a href="namespaces.html">
              <i class="octicon octicon-gist"></i>
              <span>Namespaces</span>
            </a>
          </li>
        </ul>
      </li>
      <li>
        <a href="files.html">
          <i class="octicon octicon-file-directory"></i><span>Files</span>
        </a>
      </li>
      <li>
        <a href="citelist.html">
          <i class="octicon octicon-file-text"></i><span>Bibliography</span>
        </a>
      </li>
      <li>
        <a href="https://github.com/sxs-collaboration/spectre" target="_blank">
          <i class="octicon octicon-mark-github"></i><span>View on GitHub</span>
        </a>
      </li>
      <!--The Search <li> is added by doxygen later-->
    </ul>
  </div><!-- main-nav -->
  </div><!-- titlearea -->
  <!-- window showing the filter options -->
  <div id="MSearchSelectWindow"  style="position: fixed;"
       onmouseover="return searchBox.OnSearchSelectShow()"
       onmouseout="return searchBox.OnSearchSelectHide()"
       onkeydown="return searchBox.OnSearchSelectKey(event)">
  </div>
  <!-- iframe showing the search results (closed by default) -->
  <div id="MSearchResultsWindow"  style="position: fixed;">
  <iframe src="javascript:void(0)" frameborder="0"
          name="MSearchResults" id="MSearchResults">
  </iframe>
  </div>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Importing data </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>importers</code> namespace holds functionality for importing data into SpECTRE. We currently support loading volume data files in the same format that is written by the <code>observers</code>.</p>
<h1><a class="anchor" id="autotoc_md78"></a>
Importing volume data</h1>
<p>The <code><a class="el" href="structimporters_1_1VolumeDataReader.html" title="A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...">importers::VolumeDataReader</a></code> parallel component is responsible for loading volume data and distributing it to elements of one or multiple array parallel components. As a first step, make sure you have added the <code><a class="el" href="structimporters_1_1VolumeDataReader.html" title="A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...">importers::VolumeDataReader</a></code> to your <code>Metavariables::component_list</code>. Also make sure you have a <code>Metavariables::Phase</code> in which you will perform registration with the importer, and another for loading the data. Here's an example for such <code>Metavariables</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">size_t</span> Dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Metavariables {</div>
<div class="line">  <span class="keyword">using</span> component_list =</div>
<div class="line">      tmpl::list&lt;ElementArray&lt;Dim, Grid::Fine, Metavariables&gt;,</div>
<div class="line">                 ElementArray&lt;Dim, Grid::Coarse, Metavariables&gt;,</div>
<div class="line">                 TestDataWriter&lt;Dim, Metavariables&gt;,</div>
<div class="line">                 <a class="code" href="structimporters_1_1VolumeDataReader.html">importers::VolumeDataReader&lt;Metavariables&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> constexpr <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> help{<span class="stringliteral">&quot;Test the volume data reader&quot;</span>};</div>
<div class="line">  <span class="keyword">static</span> constexpr <span class="keywordtype">bool</span> ignore_unrecognized_command_line_options = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum class</span> Phase { Initialization, Register, ImportData, TestResult, Exit };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> Phase determine_next_phase(</div>
<div class="line">      <span class="keyword">const</span> Phase&amp; current_phase,</div>
<div class="line">      <span class="keyword">const</span> Parallel::CProxy_ConstGlobalCache&lt;</div>
<div class="line">          Metavariables&gt;&amp; <span class="comment">/*cache_proxy*/</span>) noexcept {</div>
<div class="line">    <span class="keywordflow">switch</span> (current_phase) {</div>
<div class="line">      <span class="keywordflow">case</span> Phase::Initialization:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::Register;</div>
<div class="line">      <span class="keywordflow">case</span> Phase::Register:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::ImportData;</div>
<div class="line">      <span class="keywordflow">case</span> Phase::ImportData:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::TestResult;</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::Exit;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p> To register elements of your array parallel component for receiving volume data, invoke the <code><a class="el" href="structimporters_1_1Actions_1_1RegisterWithVolumeDataReader.html" title="Register an element with the volume data reader component.">importers::Actions::RegisterWithVolumeDataReader</a></code> action in the <code>phase_dependent_action_list</code>. Here's an example:</p>
<div class="fragment"><div class="line">      <a class="code" href="structParallel_1_1PhaseActions.html">Parallel::PhaseActions</a>&lt;</div>
<div class="line">          <span class="keyword">typename</span> Metavariables::Phase, Metavariables::Phase::Register,</div>
<div class="line">          tmpl::list&lt;<a class="code" href="structimporters_1_1Actions_1_1RegisterWithVolumeDataReader.html">importers::Actions::RegisterWithVolumeDataReader</a>,</div>
<div class="line">                     <a class="code" href="structParallel_1_1Actions_1_1TerminatePhase.html">Parallel::Actions::TerminatePhase</a>&gt;&gt;,</div>
</div><!-- fragment --><p> Now you're all set to load a data file. To do so, invoke the <code><a class="el" href="structimporters_1_1ThreadedActions_1_1ReadVolumeData.html" title="Read a volume data file and distribute the data to the registered elements.">importers::ThreadedActions::ReadVolumeData</a></code> action on the <code><a class="el" href="structimporters_1_1VolumeDataReader.html" title="A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...">importers::VolumeDataReader</a></code>. A good place for this is the <code>execute_next_phase</code> function of the array parallel component:</p>
<div class="fragment"><div class="line">  <span class="keyword">using</span> import_fields = tmpl::list&lt;ScalarFieldTag, VectorFieldTag&lt;Dim&gt;&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using</span> read_element_data_action = <a class="code" href="structimporters_1_1ThreadedActions_1_1ReadVolumeData.html">importers::ThreadedActions::ReadVolumeData</a>&lt;</div>
<div class="line">      VolumeDataOptions&lt;TheGrid&gt;, import_fields,</div>
<div class="line">      <a class="code" href="structActions_1_1SetData.html">::Actions::SetData&lt;import_fields&gt;</a>, ElementArray&gt;;</div>
</div><!-- fragment --> <div class="fragment"><div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> execute_next_phase(</div>
<div class="line">      <span class="keyword">const</span> <span class="keyword">typename</span> Metavariables::Phase next_phase,</div>
<div class="line">      Parallel::CProxy_ConstGlobalCache&lt;Metavariables&gt;&amp; global_cache) noexcept {</div>
<div class="line">    <span class="keyword">auto</span>&amp; local_cache = *(global_cache.ckLocalBranch());</div>
<div class="line">    Parallel::get_parallel_component&lt;ElementArray&gt;(local_cache)</div>
<div class="line">        .start_phase(next_phase);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (next_phase == Metavariables::Phase::ImportData) {</div>
<div class="line">      Parallel::threaded_action&lt;read_element_data_action&gt;(</div>
<div class="line">          <a class="code" href="group__ParallelGroup.html#ga267c8d6d5f2313bd05ed69f91485776f">Parallel::get_parallel_component</a>&lt;</div>
<div class="line">              <a class="code" href="structimporters_1_1VolumeDataReader.html">importers::VolumeDataReader&lt;Metavariables&gt;</a>&gt;(local_cache));</div>
<div class="line">    }</div>
<div class="line">  }</div>
</div><!-- fragment --><p> In the first snippet the <code>read_element_data_action</code> type alias is set to a specialization of the <code><a class="el" href="structimporters_1_1ThreadedActions_1_1ReadVolumeData.html" title="Read a volume data file and distribute the data to the registered elements.">importers::ThreadedActions::ReadVolumeData</a></code> template. Its first template parameter specifies an option group that determines the data file to load, the second parameter is a typelist of the tags to import and fill with the volume data, the third parameter is the action that is called upon receiving the data on the array elements, and the last template parameter is the parallel component on which the callback action will be invoked. See the documentation of the <code><a class="el" href="structimporters_1_1ThreadedActions_1_1ReadVolumeData.html" title="Read a volume data file and distribute the data to the registered elements.">importers::ThreadedActions::ReadVolumeData</a></code> action for details on these parameters. Here is more information on the parameters used in the example above:</p>
<ul>
<li><p class="startli">The <code>VolumeDataOptions</code> in this example is an option group that supplies information such as the file name. You provide an option group that represents the data you want to import. For example, we have the <code><a class="el" href="structevolution_1_1OptionTags_1_1NumericInitialData.html" title="Holds option tags for importing numeric initial data for an evolution.">evolution::OptionTags::NumericInitialData</a></code> that represents numeric initial data for an evolution. In our example, we created a new class like this:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;Gr<span class="keywordtype">id</span> TheGr<span class="keywordtype">id</span>&gt;</div>
<div class="line"><span class="keyword">struct </span>VolumeDataOptions {</div>
<div class="line">  <span class="keyword">using</span> group = <a class="code" href="structimporters_1_1OptionTags_1_1Group.html">importers::OptionTags::Group</a>;</div>
<div class="line">  <span class="keyword">static</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> name() noexcept {</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classMakeString.html">MakeString</a>{} &lt;&lt; TheGrid &lt;&lt; <span class="stringliteral">&quot;VolumeData&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">static</span> constexpr <a class="code" href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a> help = <span class="stringliteral">&quot;Numeric volume data&quot;</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><p> This results in a section in the input file that may look like this:</p>
<div class="fragment"><div class="line">Importers:</div>
<div class="line">  FineVolumeData:</div>
<div class="line">    FileName: &quot;Test_DataImporterAlgorithm2D_shared.h5&quot;</div>
<div class="line">    Subgroup: &quot;fine_data&quot;</div>
<div class="line">    ObservationValue: 3.</div>
<div class="line">  CoarseVolumeData:</div>
<div class="line">    FileName: &quot;Test_DataImporterAlgorithm2D_shared.h5&quot;</div>
<div class="line">    Subgroup: &quot;coarse_data&quot;</div>
<div class="line">    ObservationValue: 2.</div>
</div><!-- fragment --></li>
<li>The <code><a class="el" href="structActions_1_1SetData.html" title="Mutate the DataBox tags in TagsList according to the data.">Actions::SetData</a></code> callback action in the example will be invoked to receive the data on each element. You can use this particular action to move the received data directly into the DataBox, but it's generally better to write a new action that does a few consistency checks on the data before moving it into the DataBox.</li>
</ul>
<p>When the <code><a class="el" href="structimporters_1_1ThreadedActions_1_1ReadVolumeData.html" title="Read a volume data file and distribute the data to the registered elements.">importers::ThreadedActions::ReadVolumeData</a></code> is invoked, the data file will be read and its data distributed to all elements of the array that have been registered. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="abasic_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></div></div>
<div class="ttc" id="astructParallel_1_1Actions_1_1TerminatePhase_html"><div class="ttname"><a href="structParallel_1_1Actions_1_1TerminatePhase.html">Parallel::Actions::TerminatePhase</a></div><div class="ttdoc">Terminate the algorithm to proceed to the next phase.</div><div class="ttdef"><b>Definition:</b> TerminatePhase.hpp:26</div></div>
<div class="ttc" id="astructimporters_1_1OptionTags_1_1Group_html"><div class="ttname"><a href="structimporters_1_1OptionTags_1_1Group.html">importers::OptionTags::Group</a></div><div class="ttdoc">Groups the data importer configurations in the input file.</div><div class="ttdef"><b>Definition:</b> Tags.hpp:24</div></div>
<div class="ttc" id="astructParallel_1_1PhaseActions_html"><div class="ttname"><a href="structParallel_1_1PhaseActions.html">Parallel::PhaseActions</a></div><div class="ttdoc">List of all the actions to be executed in the specified phase.</div><div class="ttdef"><b>Definition:</b> PhaseDependentActionList.hpp:16</div></div>
<div class="ttc" id="astructimporters_1_1ThreadedActions_1_1ReadVolumeData_html"><div class="ttname"><a href="structimporters_1_1ThreadedActions_1_1ReadVolumeData.html">importers::ThreadedActions::ReadVolumeData</a></div><div class="ttdoc">Read a volume data file and distribute the data to the registered elements.</div><div class="ttdef"><b>Definition:</b> VolumeDataReaderActions.hpp:96</div></div>
<div class="ttc" id="agroup__ParallelGroup_html_ga267c8d6d5f2313bd05ed69f91485776f"><div class="ttname"><a href="group__ParallelGroup.html#ga267c8d6d5f2313bd05ed69f91485776f">Parallel::get_parallel_component</a></div><div class="ttdeci">auto get_parallel_component(ConstGlobalCache&lt; Metavariables &gt; &amp;cache) noexcept -&gt; Parallel::proxy_from_parallel_component&lt; ConstGlobalCache_detail::get_component_if_mocked&lt; typename Metavariables::component_list, ParallelComponentTag &gt;&gt; &amp;</div><div class="ttdoc">Access the Charm++ proxy associated with a ParallelComponent.</div><div class="ttdef"><b>Definition:</b> ConstGlobalCache.hpp:223</div></div>
<div class="ttc" id="astructimporters_1_1VolumeDataReader_html"><div class="ttname"><a href="structimporters_1_1VolumeDataReader.html">importers::VolumeDataReader</a></div><div class="ttdoc">A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...</div><div class="ttdef"><b>Definition:</b> VolumeDataReader.hpp:32</div></div>
<div class="ttc" id="astructimporters_1_1Actions_1_1RegisterWithVolumeDataReader_html"><div class="ttname"><a href="structimporters_1_1Actions_1_1RegisterWithVolumeDataReader.html">importers::Actions::RegisterWithVolumeDataReader</a></div><div class="ttdoc">Register an element with the volume data reader component.</div><div class="ttdef"><b>Definition:</b> ElementActions.hpp:31</div></div>
<div class="ttc" id="aOptions_8hpp_html_ac6df7d1b74fbddedd85b06a0087d93f6"><div class="ttname"><a href="Options_8hpp.html#ac6df7d1b74fbddedd85b06a0087d93f6">OptionString</a></div><div class="ttdeci">const char *const OptionString</div><div class="ttdoc">The string used in option structs.</div><div class="ttdef"><b>Definition:</b> Options.hpp:30</div></div>
<div class="ttc" id="aclassMakeString_html"><div class="ttname"><a href="classMakeString.html">MakeString</a></div><div class="ttdoc">Make a string by streaming into object.</div><div class="ttdef"><b>Definition:</b> MakeString.hpp:16</div></div>
<div class="ttc" id="astructActions_1_1SetData_html"><div class="ttname"><a href="structActions_1_1SetData.html">Actions::SetData</a></div><div class="ttdoc">Mutate the DataBox tags in TagsList according to the data.</div><div class="ttdef"><b>Definition:</b> SetData.hpp:32</div></div>
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; Copyright 2017 - 2020
<a href="https://black-holes.org">SXS Collaboration</a>,
<a href="LICENSE.txt" target="_blank">
<span class="hidden-xs">Distributed under the</span>
MIT License</a>
</small></address>
</body>
</html>
